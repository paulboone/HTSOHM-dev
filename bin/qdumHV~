#!/bin/bash
#PBS -N dummyHV_screen
#PBS -o dummyHV_screen.out
#PBS -e dummyHV_screen.err
#PBS -l nodes=1:ppn=1
#PBS -l walltime=03:00:00
#PBS -q shared

cd $PBS_O_WORKDIR
# change this for your environment
export RASPA_DIR=${HOME}/RASPA
export HTSOHM_DIR=${HOME}/HTSOHM-dev

        P_DIR=$DIR
	START_FILE=$INITIAL
	NUM_FILES=$TOTAL
	#FILE_NAME=$NAME
	#FILE_LIST=$FILELIST

	cp $HTSOHM_DIR/bin/HVsim $SCRATCH/HVsim

	cd $SCRATCH

        IFS=$'\n' read -d '' -r -a D_LIST < $HTSOHM_DIR/$P_DIR/dummyList.txt

	for ((i = START_FILE; i < NUM_FILES + START_FILE; i++))
	do
		MAT_NAME="${D_LIST[i]}"
	
		#copy forcefield data
		cp $RASPA_DIR/share/raspa/forcefield/$MAT_NAME/* $SCRATCH

	#he simulation	
		sed -i "s/^Forcefield.*/Forcefield                    $MAT_NAME/" $SCRATCH/HVsim
		sed -i "s/^FrameworkName.*/FrameworkName $MAT_NAME/" $SCRATCH/HVsim
		$RASPA_DIR/bin/simulate -i HVsim

	#HV data
		VALUE=$(cat $SCRATCH/Output/System_0/output* | grep "Average Widom:" | awk '{print $4"\t"$6}')
		echo $MAT_NAME"   "$VALUE >> HVdata2col.txt
		echo $VALUE >> HVdata.txt
		rm -rf DLPOLY Movies Output Restart Tinker VTK
	rm *.def

	mkdir dummyVF-$INITIAL.thru.$TOTAL
	cp *.txt ./dummyVF-$INITIAL.thru.$TOTAL
	cp -rf dummyVF-$INITIAL.thru.$TOTAL $HTSOHM_DIR/data

	done
